<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>Approval Kit | Approval Kit 文档</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="审批流核心库,专注于管理审批模板和审批任务的状态流转"><meta name=generator content="Hugo 0.152.2"><meta name=robots content="index, follow"><meta name=author content="Approval Kit Team"><link rel=stylesheet href=/approval-kit/ananke/css/main.min.efe4d852f731d5d1fbb87718387202a97aafd768cdcdaed0662bbe6982e91824.css><link href=/approval-kit/index.xml rel=alternate type=application/rss+xml title="Approval Kit 文档"><link href=/approval-kit/index.xml rel=feed type=application/rss+xml title="Approval Kit 文档"><link rel=canonical href=https://mautops.github.io/approval-kit/><meta property="og:url" content="https://mautops.github.io/approval-kit/"><meta property="og:site_name" content="Approval Kit 文档"><meta property="og:title" content="Approval Kit"><meta property="og:description" content="审批流核心库,专注于管理审批模板和审批任务的状态流转"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="website"><meta itemprop=name content="Approval Kit"><meta itemprop=description content="审批流核心库,专注于管理审批模板和审批任务的状态流转"><meta itemprop=datePublished content="2025-11-19T00:00:00+00:00"><meta itemprop=dateModified content="2025-11-19T00:00:00+00:00"><meta itemprop=wordCount content="102"><meta name=twitter:card content="summary"><meta name=twitter:title content="Approval Kit"><meta name=twitter:description content="审批流核心库,专注于管理审批模板和审批任务的状态流转"></head><body class="ma0 avenir bg-near-white production"><header><div class="pb3-m pb6-l bg-black"><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l center items-center justify-between"><a href=/approval-kit/ class="f3 fw2 hover-white white-90 dib no-underline">Approval Kit 文档</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white white-90 no-underline" href=/approval-kit/ title="首页 page">首页</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white white-90 no-underline" href=/approval-kit/getting-started/ title="快速开始 page">快速开始</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white white-90 no-underline" href=/approval-kit/concepts/ title="核心概念 page">核心概念</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white white-90 no-underline" href=/approval-kit/api/ title="API 参考 page">API 参考</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white white-90 no-underline" href=/approval-kit/examples/ title="使用示例 page">使用示例</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white white-90 no-underline" href=/approval-kit/architecture/ title="架构设计 page">架构设计</a></li></ul><div class=ananke-socials></div></div></div></nav><div class="tc-l pv3 ph3 ph4-ns"><h1 class="f2 f-subheadline-l fw2 light-silver mb0 lh-title">Approval Kit</h1><h2 class="fw1 f5 f3-l white-80 measure-wide-l center lh-copy mt3 mb4">审批流核心库,专注于管理审批模板和审批任务的状态流转</h2></div></div></header><main class=pb7 role=main><article class="cf ph3 ph5-l pv3 pv4-l f4 tc-l center measure-wide lh-copy nested-links mid-gray"><h2 id=简介>简介</h2><p>Approval Kit 是一个业务无关的审批流核心库,专注于管理审批模板和审批任务的状态流转.本库不包含任何数据持久化逻辑,通过接口抽象与上层业务系统解耦.</p><h2 id=核心特性>核心特性</h2><ul><li><strong>状态机管理</strong>: 基于有限状态机(FSM)确保状态转换的合法性和一致性</li><li><strong>多种审批模式</strong>: 支持单人审批、会签、或签、比例会签、顺序审批</li><li><strong>灵活的条件分支</strong>: 支持数值、字符串、枚举等多种条件类型</li><li><strong>动态审批人</strong>: 支持通过 HTTP API 动态获取审批人</li><li><strong>事件通知</strong>: 支持 Webhook 事件通知机制</li><li><strong>模板版本控制</strong>: 支持模板版本管理,确保历史任务可追溯</li><li><strong>并发安全</strong>: 使用读写锁保证并发访问安全</li><li><strong>无外部依赖</strong>: 优先使用 Go 标准库,最小化外部依赖</li></ul><h2 id=设计原则>设计原则</h2><ul><li><strong>业务无关性</strong>: 不包含任何具体业务逻辑,仅负责状态流转</li><li><strong>无数据存储</strong>: 所有数据存储由上层业务系统负责</li><li><strong>测试优先</strong>: 采用 TDD 开发,关键路径测试覆盖率 100%</li><li><strong>简洁设计</strong>: 遵循 YAGNI 原则,避免过度设计</li><li><strong>API 稳定</strong>: 遵循语义化版本控制,保证向后兼容</li></ul><h2 id=快速开始>快速开始</h2><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/mautops/approval-kit/internal/task&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/mautops/approval-kit/internal/template&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 创建管理器</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>templateMgr</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>template</span>.<span style=color:#a6e22e>NewTemplateManager</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>taskMgr</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>task</span>.<span style=color:#a6e22e>NewTaskManager</span>(<span style=color:#a6e22e>templateMgr</span>, <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 创建模板和任务...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=文档导航>文档导航</h2><ul><li><a href=/getting-started/>快速开始</a> - 安装和基本使用</li><li><a href=/concepts/>核心概念</a> - 模板、任务、状态机等核心概念</li><li><a href=/api/>API 参考</a> - 完整的 API 文档</li><li><a href=/examples/>使用示例</a> - 25 个实际使用场景</li><li><a href=/architecture/>架构设计</a> - 系统架构和设计理念</li></ul></article><div class="pa3 pa4-ns w-100 w-70-ns center"><section class="w-100 mw8"><div class="w-100 mb4 relative"><article class="bb b--black-10"><div class="db pv4 ph3 ph0-l dark-gray no-underline"><div class="flex-column flex-row-ns flex"><div class="blah w-100"><h1 class="f3 fw1 athelas mt0 lh-title"><a href=/approval-kit/concepts/template/ class="color-inherit dim link">审批模板</a></h1><div class="f6 f5-l lh-copy nested-copy-line-height nested-links"><h2 id=模板结构>模板结构</h2><p>审批模板定义了完整的审批流程结构,包括:</p><ul><li><strong>基本信息</strong>: ID、名称、描述、版本号</li><li><strong>节点定义</strong>: 开始节点、审批节点、条件节点、结束节点</li><li><strong>连接关系</strong>: 节点间的有向图连接</li><li><strong>全局配置</strong>: Webhook 配置、超时配置等</li></ul><h2 id=节点类型>节点类型</h2><h3 id=开始节点>开始节点</h3><p>流程的起点,每个模板必须且只能有一个开始节点.</p><h3 id=审批节点>审批节点</h3><p>执行审批操作,支持多种审批模式:</p><ul><li>单人审批</li><li>多人会签</li><li>多人或签</li><li>比例会签</li><li>顺序审批</li></ul><h3 id=条件节点>条件节点</h3><p>根据条件决定流程走向,支持多种条件类型.</p><h3 id=结束节点>结束节点</h3><p>流程的终点,标记审批流程完成.</p><h2 id=版本控制>版本控制</h2><p>模板支持版本控制,每次更新自动创建新版本.历史任务绑定到创建时的模板版本,确保可追溯.</p></div><p class="f6 lh-copy mv0">By Approval Kit Team</p><a href=/approval-kit/concepts/template/ class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a></div></div></div></article></div><div class="w-100 mb4 relative"><article class="bb b--black-10"><div class="db pv4 ph3 ph0-l dark-gray no-underline"><div class="flex-column flex-row-ns flex"><div class="blah w-100"><h1 class="f3 fw1 athelas mt0 lh-title"><a href=/approval-kit/concepts/task/ class="color-inherit dim link">审批任务</a></h1><div class="f6 f5-l lh-copy nested-copy-line-height nested-links"><h2 id=任务结构>任务结构</h2><p>审批任务是基于模板创建的实例,包含:</p><ul><li><strong>基本信息</strong>: ID、模板 ID、业务 ID、参数</li><li><strong>状态信息</strong>: 当前状态、当前节点</li><li><strong>运行时数据</strong>: 节点输出、审批人列表、审批结果</li><li><strong>审批记录</strong>: 所有审批操作的记录</li><li><strong>状态历史</strong>: 状态变更的完整历史</li></ul><h2 id=任务状态>任务状态</h2><ul><li><strong>pending</strong>: 待审批</li><li><strong>submitted</strong>: 已提交</li><li><strong>approving</strong>: 审批中</li><li><strong>approved</strong>: 已通过</li><li><strong>rejected</strong>: 已拒绝</li><li><strong>cancelled</strong>: 已取消</li><li><strong>timeout</strong>: 已超时</li></ul><h2 id=状态流转>状态流转</h2><p>任务状态通过状态机管理,确保状态转换的合法性和一致性.</p><p>状态转换规则:</p><ul><li><code>pending</code> → <code>submitted</code> → <code>approving</code> → <code>approved</code>/<code>rejected</code></li><li>任何状态都可以转换为 <code>cancelled</code></li><li>终态(<code>approved</code>、<code>rejected</code>、<code>cancelled</code>、<code>timeout</code>)不能转换到其他状态</li></ul><h2 id=审批记录>审批记录</h2><p>每次审批操作都会生成审批记录,包含:</p><ul><li>节点 ID</li><li>审批人</li><li>审批结果(approve/reject/transfer)</li><li>审批意见</li><li>审批时间</li><li>附件信息</li></ul></div><p class="f6 lh-copy mv0">By Approval Kit Team</p><a href=/approval-kit/concepts/task/ class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a></div></div></div></article></div><div class="w-100 mb4 relative"><article class="bb b--black-10"><div class="db pv4 ph3 ph0-l dark-gray no-underline"><div class="flex-column flex-row-ns flex"><div class="blah w-100"><h1 class="f3 fw1 athelas mt0 lh-title"><a href=/approval-kit/concepts/state-machine/ class="color-inherit dim link">状态机</a></h1><div class="f6 f5-l lh-copy nested-copy-line-height nested-links"><h2 id=设计理念>设计理念</h2><p>Approval Kit 使用有限状态机(FSM)管理任务状态流转,确保:</p><ul><li>状态转换的合法性</li><li>状态转换的一致性</li><li>状态转换的可追溯性</li></ul><h2 id=状态定义>状态定义</h2><p>任务状态包括:</p><ul><li><code>pending</code>: 待审批</li><li><code>submitted</code>: 已提交</li><li><code>approving</code>: 审批中</li><li><code>approved</code>: 已通过</li><li><code>rejected</code>: 已拒绝</li><li><code>cancelled</code>: 已取消</li><li><code>timeout</code>: 已超时</li></ul><h2 id=转换规则>转换规则</h2><p>状态转换必须遵循预定义的规则:</p><pre tabindex=0><code>pending → submitted → approving → approved/rejected
         ↓
      cancelled
</code></pre><h2 id=转换执行>转换执行</h2><p>状态转换通过 <code>StateMachine.Transition</code> 方法执行:</p><ol><li>验证转换合法性</li><li>创建新任务对象(不可变实现)</li><li>更新状态和时间戳</li><li>记录状态变更历史</li></ol><h2 id=并发安全>并发安全</h2><p>状态转换使用版本号机制确保原子性,防止并发修改冲突.</p></div><p class="f6 lh-copy mv0">By Approval Kit Team</p><a href=/approval-kit/concepts/state-machine/ class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a></div></div></div></article></div></section></div></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href=https://mautops.github.io/approval-kit/>&copy; Approval Kit 文档 2025</a><div><div class=ananke-socials></div></div></div></footer></body></html>