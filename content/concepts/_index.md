---
title: "核心概念"
description: "Approval Kit 的核心概念和设计理念"
date: 2025-11-19
draft: false
weight: 10
---

## 概述

Approval Kit 的核心概念包括审批模板、审批任务、状态机和节点执行引擎.

## 审批模板 (Template)

审批模板定义了完整的审批流程结构,包括:

- **节点定义**: 开始节点、审批节点、条件节点、结束节点
- **连接关系**: 节点间的有向图连接,支持条件分支
- **全局配置**: Webhook 配置、超时配置等

模板支持版本控制,确保历史任务可追溯.

## 审批任务 (Task)

审批任务是基于模板创建的实例,包含:

- **状态信息**: 当前状态、当前节点
- **运行时数据**: 节点输出、审批人列表、审批结果
- **审批记录**: 所有审批操作的记录
- **状态历史**: 状态变更的完整历史

## 状态机 (State Machine)

基于有限状态机(FSM)管理任务状态流转:

- **状态定义**: pending、submitted、approving、approved、rejected 等
- **转换规则**: 明确定义合法的状态转换路径
- **转换执行**: 确保状态转换的原子性和一致性

## 节点类型

### 开始节点 (Start Node)

流程的起点,每个模板必须且只能有一个开始节点.

### 审批节点 (Approval Node)

执行审批操作,支持多种审批模式:

- **单人审批**: 单个审批人审批
- **多人会签**: 所有审批人必须全部同意
- **多人或签**: 任意一人同意即可
- **比例会签**: 达到指定比例同意即可
- **顺序审批**: 按顺序依次审批

### 条件节点 (Condition Node)

根据条件决定流程走向,支持:

- **数值比较**: 大于、小于、等于等
- **字符串匹配**: 包含、开头、结尾等
- **枚举判断**: 在列表中、不在列表中
- **组合条件**: AND、OR 逻辑组合

### 结束节点 (End Node)

流程的终点,标记审批流程完成.

## 审批人配置

### 固定审批人

在模板中预设审批人列表:

```go
ApproverConfig: &node.FixedApproverConfig{
    Approvers: []string{"user-001", "user-002"},
}
```

### 动态审批人

通过 HTTP API 动态获取审批人:

```go
ApproverConfig: &node.DynamicApproverConfig{
    API: &node.HTTPAPIConfig{
        URL:    "http://api.example.com/approvers",
        Method: "POST",
        // 参数映射和响应解析配置
    },
    Timing: node.ApproverTimingOnActivate,
}
```

支持两种获取时机:
- **任务创建时**: 创建任务时立即获取
- **节点激活时**: 节点激活时获取(默认)

## 事件通知

支持通过 Webhook 推送事件通知:

- 任务创建、提交、通过、拒绝
- 节点激活、完成
- 审批操作

所有事件推送都是异步的,不阻塞主流程.

## 设计原则

### 业务无关性

本库不包含任何具体业务逻辑,仅负责状态流转.所有业务决策由上层系统处理.

### 无数据存储

本库不包含数据持久化逻辑,所有存储操作由上层系统负责.

### 接口抽象

通过小而专注的接口与上层系统交互,支持依赖注入和扩展.

