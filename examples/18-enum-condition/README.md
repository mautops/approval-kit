# 场景 18: 枚举判断条件场景

## 场景描述

这是一个枚举判断条件场景示例,演示请假审批流程,根据请假类型(枚举值)选择不同的审批路径.

**业务背景**: 请假审批需要根据请假类型选择不同的审批路径.例如,年假或调休只需要部门经理审批,病假或事假需要部门经理和HR审批,其他类型需要部门经理、HR和总经理审批.这种模式适用于需要根据预定义枚举值进行条件判断的场景.

## 流程结构

```
开始节点
  ↓
条件节点(枚举判断)
  ├─→ [年假/调休 OR 病假/事假] → 部门审批 → 结束
  └─→ [其他类型]                → HR审批 → 总经理审批 → 结束
```

流程说明:
1. **开始节点**: 流程的起点,自动执行
2. **条件节点**: 枚举判断条件节点
   - 条件类型: 组合条件 (composite)
   - 操作符: OR (任意一个条件满足即可)
   - 子条件1: 请假类型 in ["年假", "调休"]
   - 子条件2: 请假类型 in ["病假", "事假"]
   - True: 跳转到部门审批节点
   - False: 跳转到HR审批节点
3. **部门审批节点**: 条件满足时使用
   - 审批模式: 单人审批 (ApprovalModeSingle)
   - 审批人: 部门经理
4. **HR审批节点**: 条件不满足时使用
   - 审批模式: 单人审批 (ApprovalModeSingle)
   - 审批人: HR
5. **总经理审批节点**: HR审批完成后使用
   - 审批模式: 单人审批 (ApprovalModeSingle)
   - 审批人: 总经理
6. **结束节点**: 流程的终点

## 关键特性

- **枚举判断条件**: 使用 EnumConditionConfig 实现枚举判断
- **多种操作符**: 支持 in(在列表中)、not_in(不在列表中)操作符
- **多值枚举判断**: 支持多个枚举值列表判断
- **条件组合**: 支持多个枚举条件组合(AND/OR)

## 代码说明

### 主要组件

1. **模板创建** (`createTemplate`):
   - 创建包含条件节点、部门审批节点、HR审批节点、总经理审批节点的模板
   - 配置条件节点使用组合条件(OR 逻辑)
   - 配置枚举判断条件(in 操作符)

2. **枚举判断演示** (`demonstrateEnumConditions`):
   - 演示不同枚举判断的场景
   - 展示条件判断逻辑和预期路径

3. **结果输出**:
   - 输出不同场景的任务参数和条件判断结果
   - 说明枚举判断条件的配置和使用方法

### 代码结构

```go
main()
  ├── 创建管理器 (TemplateManager, TaskManager)
  ├── 创建模板 (createTemplate)
  │   └── 配置条件节点 (组合条件: OR 逻辑 + 枚举判断)
  └── 演示枚举判断 (demonstrateEnumConditions)
      ├── 场景1: 请假类型为"年假"
      ├── 场景2: 请假类型为"调休"
      ├── 场景3: 请假类型为"病假"
      └── 场景4: 请假类型为"其他"
```

### 枚举判断条件配置示例

```go
Condition: &node.Condition{
    Type: "enum",
    Config: &node.EnumConditionConfig{
        Field:    "leaveType",
        Operator: "in", // 在列表中
        Values:   []string{"年假", "调休"},
        Source:   "task_params",
    },
}
```

### 组合条件配置示例

```go
Condition: &node.Condition{
    Type: "composite",
    Config: &node.CompositeConditionConfig{
        Operator: "or", // OR 逻辑: 任意一个条件满足即可
        Conditions: []*node.Condition{
            {
                Type: "enum",
                Config: &node.EnumConditionConfig{
                    Field:    "leaveType",
                    Operator: "in",
                    Values:   []string{"年假", "调休"},
                    Source:   "task_params",
                },
            },
            {
                Type: "enum",
                Config: &node.EnumConditionConfig{
                    Field:    "leaveType",
                    Operator: "in",
                    Values:   []string{"病假", "事假"},
                    Source:   "task_params",
                },
            },
        },
    },
}
```

## 执行方法

### 前置要求

- Go 1.25.4 或更高版本
- 已安装 approval-kit 依赖

### 执行步骤

1. 进入场景目录:
   ```bash
   cd examples/18-enum-condition
   ```

2. 运行程序:
   ```bash
   go run main.go
   ```

### 预期输出

程序运行后会输出以下内容:

```
=== 场景 18: 枚举判断条件场景 ===

步骤 1: 创建审批模板
✓ 模板创建成功: ID=enum-condition-template, Name=请假审批模板

=== 场景 1: 请假类型为"年假" ===

✓ 任务创建成功: ID=task-1763522277601008000-1
  任务参数:
    requestNo: LEAVE-2025-001
    leaveType: 年假
    applicant: 员工-001
    startDate: 2025-12-01
    endDate: 2025-12-05
    days: 5
    description: 年假申请
  条件判断: 请假类型 in ["年假", "调休"] OR 请假类型 in ["病假", "事假"]
  实际结果: 请假类型="年假",在第一个列表中,条件满足
  预期路径: 部门审批路径

=== 场景 2: 请假类型为"调休" ===

✓ 任务创建成功: ID=task-1763522277601212000-2
  任务参数:
    startDate: 2025-12-10
    endDate: 2025-12-10
    days: 1
    description: 调休申请
    requestNo: LEAVE-2025-002
    leaveType: 调休
    applicant: 员工-002
  条件判断: 请假类型 in ["年假", "调休"] OR 请假类型 in ["病假", "事假"]
  实际结果: 请假类型="调休",在第一个列表中,条件满足
  预期路径: 部门审批路径

=== 场景 3: 请假类型为"病假" ===

✓ 任务创建成功: ID=task-1763522277601229000-3
  任务参数:
    endDate: 2025-12-17
    days: 3
    description: 病假申请
    requestNo: LEAVE-2025-003
    leaveType: 病假
    applicant: 员工-003
    startDate: 2025-12-15
  条件判断: 请假类型 in ["年假", "调休"] OR 请假类型 in ["病假", "事假"]
  实际结果: 请假类型="病假",在第二个列表中,条件满足
  预期路径: 部门审批路径

=== 场景 4: 请假类型为"其他" ===

✓ 任务创建成功: ID=task-1763522277601249000-4
  任务参数:
    description: 其他类型请假申请
    requestNo: LEAVE-2025-004
    leaveType: 其他
    applicant: 员工-004
    startDate: 2025-12-20
    endDate: 2025-12-25
    days: 6
  条件判断: 请假类型 in ["年假", "调休"] OR 请假类型 in ["病假", "事假"]
  实际结果: 请假类型="其他",不在任何列表中,条件不满足
  预期路径: HR审批路径 → 总经理审批路径

=== 枚举判断条件说明 ===
  枚举判断条件配置:
    - 操作符: in (在列表中)
    - 操作符: not_in (不在列表中)

  条件组合:
    - 条件1: 请假类型 in ["年假", "调休"]
    - 条件2: 请假类型 in ["病假", "事假"]
    - 组合逻辑: OR (任意一个条件满足即可)

  审批路径:
    - True (条件满足): 部门审批路径
    - False (条件不满足): HR审批路径 → 总经理审批路径

  注意: 本示例仅展示枚举判断条件的配置方法
  实际执行需要在实际业务系统中实现条件评估和流程跳转
```

**注意**: 
- 任务 ID 是动态生成的,每次运行都会不同
- 时间戳是实际运行时间,每次运行都会不同
- 任务参数中的字段顺序可能因 JSON 解析而有所不同
- 本示例仅展示枚举判断条件的配置方法,实际执行需要在实际业务系统中实现条件评估和流程跳转

## 验证步骤

1. **验证模板创建**:
   - 检查模板是否包含开始节点、条件节点、部门审批节点、HR审批节点、总经理审批节点、结束节点
   - 检查条件节点是否配置了枚举判断条件
   - 检查枚举判断条件的操作符是否正确(in)

2. **验证枚举判断条件**:
   - 检查枚举判断条件是否包含正确的字段名(leaveType)
   - 检查操作符是否正确(in)
   - 检查枚举值列表是否正确(["年假", "调休"]、["病假", "事假"])
   - 检查数据源是否正确(task_params)

3. **验证不同场景**:
   - 场景1: 请假类型为"年假" → 应该走部门审批路径
   - 场景2: 请假类型为"调休" → 应该走部门审批路径
   - 场景3: 请假类型为"病假" → 应该走部门审批路径
   - 场景4: 请假类型为"其他" → 应该走HR审批路径 → 总经理审批路径

### 验证要点

- ✓ 枚举判断条件节点已正确配置
- ✓ OR 逻辑正确实现(任意一个条件满足即可)
- ✓ in 操作符正确配置(请假类型 in ["年假", "调休"])
- ✓ 多值枚举判断正确配置(支持多个枚举值列表)
- ✓ 不同场景的条件判断结果正确

## 枚举判断操作符说明

系统支持以下枚举判断操作符:

- **in (在列表中)**: 值在指定的枚举值列表中
  - 示例: `leaveType in ["年假", "调休"]`
- **not_in (不在列表中)**: 值不在指定的枚举值列表中
  - 示例: `leaveType not_in ["年假", "调休"]`

## 适用场景

这个场景适用于以下实际业务场景:

- **请假审批**: 根据请假类型选择不同的审批路径
- **项目审批**: 根据项目状态或类型选择不同的审批路径
- **优先级判断**: 根据优先级选择不同的审批路径
- **其他枚举判断场景**: 需要根据预定义枚举值进行条件判断的场景

## 扩展说明

如果需要扩展此场景,可以考虑:

1. **测试 not_in 操作符**: 配置 not_in 操作符,测试条件判断
2. **测试更多枚举值**: 配置更多枚举值,测试条件判断
3. **测试组合条件**: 配置 AND 逻辑的组合条件,测试条件判断
4. **测试嵌套组合**: 配置嵌套的组合条件,测试复杂业务逻辑
5. **测试节点输出数据**: 使用节点输出数据作为条件数据源

## 相关场景

- **场景 03**: 条件分支审批流程 - 单个条件判断
- **场景 12**: 多条件组合判断场景 - 可以结合枚举判断实现更复杂的条件判断
- **场景 17**: 字符串匹配条件场景 - 可以结合字符串匹配和枚举判断实现更复杂的条件判断

