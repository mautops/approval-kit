---
alwaysApply: true
---

# Approval Kit Constitution

## 核心原则

### I. 业务无关性

本库必须保持业务无关,仅负责维护审批数据和状态流转.禁止包含任何具体业务逻辑、前端界面代码或 API 接口实现.所有业务相关的决策和实现应由上层业务系统处理.库的设计必须足够通用,能够适配不同的业务场景和审批流程.

### II. 无数据存储

本库不得包含任何数据持久化逻辑.所有数据存储操作(包括数据库访问、文件读写、缓存操作等)必须由上层业务系统负责.库仅提供数据结构和状态管理接口,通过依赖注入或接口抽象的方式与上层系统交互.库的设计必须支持内存操作和外部存储解耦.

### III. 状态管理核心

本库的核心职责是管理审批模板和审批任务的状态流转.必须明确定义审批状态机,确保状态转换的合法性和一致性.所有状态变更必须通过库提供的接口进行,禁止外部直接修改状态.状态管理逻辑必须清晰、可测试、可追溯.

### IV. 测试优先 (不可协商)

采用测试驱动开发(TDD): 先编写测试 → 用户批准 → 测试失败 → 然后实现.严格遵循红-绿-重构循环.所有核心功能必须包含单元测试,状态转换逻辑必须包含集成测试.测试覆盖率必须达到关键路径 100%,整体覆盖率不低于 80%.

### V. 简洁设计

遵循 YAGNI(You Aren't Gonna Need It)原则,避免过度设计.代码必须简洁明了,优先使用 Go 语言的标准库和惯用法.复杂的设计必须经过充分论证,说明为什么需要复杂性以及为什么更简单的方案不可行.保持接口最小化,避免暴露不必要的实现细节.

### VI. API 稳定性与向后兼容

类库的公共 API 变更必须谨慎,遵循语义化版本控制.主版本号内的 API 必须保持向后兼容,禁止在未升级主版本号的情况下移除或破坏性修改公共接口.新增功能优先通过扩展接口实现,而非修改现有接口.所有公共 API 必须明确标注稳定性级别(稳定/实验性/已废弃).废弃的 API 必须提供至少一个主版本号的过渡期,并给出明确的迁移路径.

### VII. 接口设计规范

所有公共接口必须遵循 Go 语言惯用法和社区最佳实践.接口应该小而专注,遵循接口隔离原则,避免臃肿的接口定义.优先使用函数式接口而非方法集接口,保持接口的单一职责.接口命名应该清晰表达意图,使用动词或动词短语命名方法,使用名词命名类型.所有接口必须包含完整的文档注释,说明用途、参数、返回值和错误情况.避免过度抽象,接口应该解决实际问题而非展示设计技巧.

### VIII. 错误处理规范

所有可能失败的操作必须返回明确的错误信息.错误应该可分类、可处理,使用 Go 的 `error` 接口或自定义错误类型实现错误分类.禁止静默忽略错误,禁止使用 panic 处理业务逻辑错误.错误信息应该包含足够的上下文信息,便于上层系统处理和日志记录.提供错误包装机制,支持错误链追踪.关键错误应该定义错误常量或错误类型,便于上层系统进行错误判断和处理.

### IX. 依赖最小化

类库应该尽可能减少外部依赖,优先使用 Go 标准库.引入第三方依赖必须经过充分论证,说明为什么标准库无法满足需求.禁止引入仅用于单一功能的重量级依赖.所有依赖必须明确版本,并在 go.mod 中锁定.定期审查依赖,移除不再需要的依赖.优先选择维护活跃、社区认可度高的依赖库.

### X. 可扩展性设计

类库设计应该支持通过接口扩展和插件机制实现功能扩展.核心功能与扩展点应该清晰分离,避免扩展逻辑污染核心代码.提供合理的扩展钩子(hooks)和回调机制,允许上层系统自定义行为.扩展接口应该稳定,避免频繁变更.扩展点应该文档化,提供扩展示例和最佳实践指南.支持通过依赖注入实现行为替换,而非硬编码实现.

### XI. 文档完整性

所有公共 API、类型、函数必须包含完整的 Go 文档注释,遵循 Go 文档注释规范.提供使用示例代码,展示常见使用场景和最佳实践.状态机定义必须包含详细的状态转换图和说明文档.提供迁移指南,说明版本间的变更和升级步骤.README 必须包含快速开始指南、API 概览和常见问题解答.所有示例代码必须可运行,并包含在测试或示例目录中.

### XII. 性能考虑

虽然不涉及数据存储,但状态转换和数据处理逻辑应该考虑性能影响.避免不必要的内存分配,合理使用对象池和内存复用技术.提供性能基准测试,确保关键路径的性能指标可测量.接口设计应该支持批量操作,减少函数调用开销.避免在热点路径上进行不必要的计算或验证.性能优化必须基于实际测量数据,避免过早优化.

## 技术约束

### 语言与版本

- **语言**: Go 1.25.4 或更高版本
- **依赖管理**: 使用 Go modules
- **代码风格**: 遵循 Go 官方代码规范和 `gofmt` 格式化
- **代码检查**: 必须通过 `go vet` 和 `golangci-lint` 检查

### 架构约束

- **无外部存储依赖**: 库不得依赖任何数据库、文件系统或缓存库
- **接口抽象**: 通过接口定义与上层系统的交互契约
- **纯函数优先**: 状态转换逻辑尽可能使用纯函数实现,便于测试和推理
- **并发安全**: 所有公开接口必须保证并发安全,明确文档化并发使用场景
- **不可变优先**: 数据结构设计优先考虑不可变性,减少并发问题

### 文档要求

- 所有公共 API 必须包含 Go 文档注释,遵循 `godoc` 规范
- 状态机定义必须包含状态转换图或详细说明文档
- 示例代码必须展示基本使用场景,包含在 `examples/` 目录
- 每个主要功能模块必须包含使用指南

## 开发流程

### 代码审查

- 所有 PR 必须验证是否符合本 constitution 的所有原则
- 复杂设计必须提供 Complexity Tracking 表格说明
- 测试覆盖率不达标不得合并
- API 变更必须提供向后兼容性说明
- 新增依赖必须说明引入理由

### 版本管理

- 遵循语义化版本控制 (Semantic Versioning)
- **MAJOR**: 破坏性 API 变更或状态机定义变更
- **MINOR**: 新增功能,向后兼容
- **PATCH**: bug 修复,向后兼容
- 每个版本必须包含 CHANGELOG,说明变更内容

### 质量门禁

- 所有代码必须通过 `go vet` 和 `golangci-lint` 检查
- 测试必须全部通过,关键路径测试覆盖率必须 100%
- 所有公共 API 必须有文档注释
- 性能关键路径必须有基准测试
- 示例代码必须可编译运行

### 发布流程

- 发布前必须更新版本号和 CHANGELOG
- 必须运行完整的测试套件和基准测试
- 必须验证所有示例代码可正常运行
- 必须检查文档完整性
- 重大版本发布前必须提供迁移指南

## Governance

本 constitution 优先于所有其他开发实践和约定.任何对本 constitution 的修改必须:

1. 提供明确的修改理由和影响分析
2. 更新版本号和修改日期
3. 同步更新所有相关模板文件(plan-template.md, spec-template.md, tasks-template.md 等)
4. 在 Sync Impact Report 中记录所有变更
5. 通知所有项目参与者

所有 PR 和代码审查必须验证是否符合本 constitution.任何违反原则的代码必须提供 Complexity Tracking 表格说明为什么需要违反,否则不得合并.

新增原则或重大原则修改需要:

- 至少一名核心维护者的批准
- 在项目 issue 或讨论区公开讨论
- 更新相关文档和示例

**Version**: 1.0.0 | **Ratified**: 2025-11-18 | **Last Amended**: 2025-11-18
